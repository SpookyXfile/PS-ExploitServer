package com.spookyx.xploitserver5;


import android.app.Activity;
import android.os.AsyncTask;

import java.lang.ref.WeakReference;

import spookyx.lib.tools.AlertDialogBox;
import spookyx.lib.tools.WifiTools;


public class EnableWifi extends AsyncTask<Void, Integer, Integer>
{
    private WeakReference<Activity> _weakActivity;

    private AlertDialogBox alertEnableWifiBox;


    private WifiTools wifiTools;

    EnableWifi( Activity activity )
    {
        _weakActivity = new WeakReference<>( activity );

        wifiTools = new WifiTools( _weakActivity.get().getApplicationContext() );

    }

    @Override
    protected void onPreExecute()
    {
        alertEnableWifiBox = new AlertDialogBox( _weakActivity.get() );

        alertEnableWifiBox.createSimpleDialog( _weakActivity.get(), R.drawable.information_3,
                "Wifi Connection", "Enable Wifi in progress...",
                false,null );

    }

    @Override
    protected Integer doInBackground( Void... voids )
    {
        wifiTools.enableWiFi( _weakActivity.get().getApplicationContext(),true );

        while ( !wifiTools.checkWifiOnAndConnected( _weakActivity.get().getApplicationContext() ) )
        {
             publishProgress(-1 );
        }

        publishProgress(0 );

        return null;
    }

    @Override
    protected void onProgressUpdate( Integer... values )
    {
        if ( values[0] != -1 )
        {
            alertEnableWifiBox.showSimpleDialogBox( false );
        }
        else
            {
                alertEnableWifiBox.showSimpleDialogBox( true );

                wifiTools.enableWiFi( _weakActivity.get().getApplicationContext(),true );
            }

    }

    @Override
    protected void onPostExecute( Integer progress )
    {
        cancel(true );

    }


}
